

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CureQ._features &mdash; MEA Analysis Tool 1.2.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=010db75e"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            MEA Analysis Tool
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">CureQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">MEA Analysis Tool</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">CureQ._features</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for CureQ._features</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">pacf</span>

<div class="viewcode-block" id="electrode_features">
<a class="viewcode-back" href="../../CureQ.html#CureQ._features.electrode_features">[docs]</a>
<span class="k">def</span> <span class="nf">electrode_features</span><span class="p">(</span><span class="n">well</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate electrode features for all electrodes in a well.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    well : int</span>
<span class="sd">        The well for which the electrode features are to be calculated.</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Dictionary containing global paramaters. The function will extract the values needed</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    features_df : pandas Dataframe</span>
<span class="sd">        Dataframe containing electrodes for rows and features for columns.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define all lists for the features</span>
    <span class="n">wells_df</span><span class="p">,</span> <span class="n">electrodes_df</span><span class="p">,</span> <span class="n">spikes</span><span class="p">,</span> <span class="n">mean_firingrate</span><span class="p">,</span> <span class="n">mean_ISI</span><span class="p">,</span> <span class="n">median_ISI</span><span class="p">,</span> <span class="n">ratio_median_over_mean</span><span class="p">,</span> <span class="n">IIV</span><span class="p">,</span> <span class="n">CVI</span><span class="p">,</span> <span class="n">ISIPACF</span>  <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">burst_amnt</span><span class="p">,</span> <span class="n">avg_burst_len</span><span class="p">,</span> <span class="n">burst_var</span><span class="p">,</span> <span class="n">burst_CV</span><span class="p">,</span> <span class="n">mean_IBI</span><span class="p">,</span> <span class="n">IBI_var</span><span class="p">,</span> <span class="n">IBI_CV</span><span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">intraBFR</span><span class="p">,</span> <span class="n">interBFR</span><span class="p">,</span> <span class="n">mean_spikes_per_burst</span><span class="p">,</span> <span class="n">isolated_spikes</span><span class="p">,</span> <span class="n">MAD_spikes_per_burst</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">SCB_rate</span><span class="p">,</span> <span class="n">IBIPACF</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    

    <span class="n">spikepath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/spike_values&quot;</span>
    <span class="n">burstpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/burst_values&quot;</span>
    <span class="n">networkpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/network_data&quot;</span>
    
    <span class="n">electrodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="n">well</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">],</span> <span class="n">well</span><span class="o">*</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">])</span>

    <span class="c1"># Loop through all the measured electrodes</span>
    <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">electrodes</span><span class="p">:</span>
        <span class="c1"># Calculate current well number and append to list</span>
        <span class="n">well_nr</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">electrode</span> <span class="o">/</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.505</span><span class="p">)</span>
        <span class="n">wells_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">well_nr</span><span class="p">)</span>

        <span class="c1"># Calculate current MEA electrode number and append to list</span>
        <span class="n">electrode_nr</span> <span class="o">=</span> <span class="n">electrode</span> <span class="o">%</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">electrodes_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">electrode_nr</span><span class="p">)</span>
        
        <span class="c1"># Load in the files</span>
        <span class="n">spikedata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">spikepath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well_nr</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode_nr</span><span class="si">}</span><span class="s1">_spikes.npy&#39;</span><span class="p">)</span>
        <span class="n">burst_cores</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">burstpath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well_nr</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode_nr</span><span class="si">}</span><span class="s1">_burst_cores.npy&#39;</span><span class="p">)</span>
        <span class="n">burst_spikes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">burstpath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well_nr</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode_nr</span><span class="si">}</span><span class="s1">_burst_spikes.npy&#39;</span><span class="p">)</span>

<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">        Calculate your own features here</span>
<span class="sd">        Step by step guide:</span>
<span class="sd">        1. Initialize a list prior to this for-loop, you will be adding the calculated feature of every electrode to this list</span>
<span class="sd">        2. You have access to the following variables after this line of code:</span>
<span class="sd">            spikedata = contains a row for every spike that has been detected, each row has 3 columns:</span>
<span class="sd">                spikedata[spike, 0] = the x-value of the spike, aka the time it was registered. Value is given in seconds</span>
<span class="sd">                spikedata[spike, 1] = the y value of the spike, aka the amplitude of the spike</span>
<span class="sd">                spikedata[spike, 2] = the python index where the spike was found in the list of raw voltage values</span>
<span class="sd">            burst_cores = The location of the single channel bursts that were detected in the electrodes, this array contains a row for each burst, each containing 5 columns:</span>
<span class="sd">                burst_cores[burst, 0] = the the start of the burst, given in seconds</span>
<span class="sd">                burst_cores[burst, 1] = the end of the burst, given in seconds</span>
<span class="sd">                burst_cores[burst, 2] = python list index of the start of the burst</span>
<span class="sd">                burst_cores[burst, 3] = python list index of the end of the burst</span>
<span class="sd">                burst_cores[burst, 4] = burst ID. Each burst is given its own unique (to the electrode) ID,</span>
<span class="sd">                    this allows us to couple bursts to spikes contained in bursts, which are located in the variable &quot;burst_spikes&quot;</span>
<span class="sd">            burst_spikes = contains information of all the spikes that are found in the single channel bursts.</span>
<span class="sd">            contains a row for every single spike in an electrode that is part of a burst, each row contains 4 columns</span>
<span class="sd">                burst_spikes[spike, 0:3] = exactly the same as spikedata^</span>
<span class="sd">                burst_spikes[spike, 3] = The burst ID of the burst that it participates in</span>
<span class="sd">        3. Calculate the feature. If you calculate it in this for-loop, it will automatically be calculated for each of the electrodes</span>
<span class="sd">           Warning: sometimes it is not possible to calculate a features due to a lack of detected bursts/spikes.</span>
<span class="sd">           always check if there are enough values to calculate the feature using an if-statement, if there are not, append &quot;float(&quot;NaN&quot;)&quot; to the list</span>
<span class="sd">        4. Append your feature to the list</span>
<span class="sd">        5. At the end of this function, add your list to the pandas dataframe, and give the column the correct name.</span>
<span class="sd">           Now if you run the analysis again, you should see your own feature in the &quot;Features.csv&quot; output file</span>
<span class="sd">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># Calculate the total amount of spikes</span>
        <span class="n">spike</span><span class="o">=</span><span class="n">spikedata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spike</span><span class="p">)</span>

        <span class="c1"># Calculate the average firing frequency frequency</span>
        <span class="n">firing_frequency</span><span class="o">=</span><span class="n">spike</span><span class="o">/</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sampling rate&#39;</span><span class="p">])</span>
        <span class="n">mean_firingrate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firing_frequency</span><span class="p">)</span>

        <span class="c1"># Calculate mean inter spike interval</span>
        <span class="n">spikeintervals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Iterate over every registered spike</span>
        <span class="k">if</span> <span class="n">spikedata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">mean_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
            <span class="n">median_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
            <span class="n">ratio_median_over_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">spikeintervals</span><span class="o">=</span><span class="n">spikedata</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">spikedata</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">mean_ISI_electrode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">)</span>
            <span class="n">mean_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_ISI_electrode</span><span class="p">)</span>
        
            <span class="c1"># Calculate the median of the ISIs</span>
            <span class="n">median_ISI_electrode</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">)</span>
            <span class="n">median_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_ISI_electrode</span><span class="p">)</span>

            <span class="c1"># Calculate the ratio of median ISI over mean ISI</span>
            <span class="n">ratio_median_over_mean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_ISI_electrode</span><span class="o">/</span><span class="n">mean_ISI_electrode</span><span class="p">)</span>

        <span class="c1"># Calculate Interspike interval variance</span>
        <span class="k">if</span> <span class="n">spikedata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">IIV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IIV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">))</span>

        <span class="c1"># Calculate the coeficient of variation of the interspike intervals</span>
        <span class="k">if</span> <span class="n">spikedata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">CVI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CVI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">))</span>

        <span class="c1"># Calculate the partial autocorrelation function</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">ISIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ISIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pacf</span><span class="p">(</span><span class="n">spikeintervals</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;yw&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Calculate the total amount of bursts</span>
        <span class="n">burst_amnt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">))</span>

        <span class="c1"># Calculate the average length of the bursts</span>
        <span class="n">burst_lens</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">burst_cores</span><span class="p">:</span>
            <span class="n">burst_lens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">avg</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">)</span>
        <span class="n">avg_burst_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">avg</span><span class="p">)</span>

        <span class="c1"># Calculate the variance of the burst length</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">burst_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">burst_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">))</span>

        <span class="c1"># Calculate the coefficient of variation of the burst lengths</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">burst_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">burst_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">burst_lens</span><span class="p">))</span>

        <span class="c1"># Calculate the average time between bursts</span>
        <span class="n">IBIs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time_to_next_burst</span><span class="o">=</span><span class="n">burst_cores</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">burst_cores</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">IBIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_to_next_burst</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IBIs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">mean_IBI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mean_IBI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">IBIs</span><span class="p">))</span>

        <span class="c1"># Calculate the variance of interburst intervals</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IBIs</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">IBI_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IBI_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">IBIs</span><span class="p">))</span>

        <span class="c1"># Calculate the coefficient of variation of the interburst intervals</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IBIs</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">IBI_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IBI_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">IBIs</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">IBIs</span><span class="p">))</span>

        <span class="c1"># Calculate the partial autocorrelation function of the interburst intervals</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IBIs</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">IBIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">IBIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pacf</span><span class="p">(</span><span class="n">IBIs</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;yw&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Calculate the mean intraburst firing rate and average amount of spikes per burst</span>
        <span class="n">IBFRs</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">spikes_per_burst</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1"># Iterate over all the bursts</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)):</span>
                <span class="n">locs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">burst_spikes</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span>
                <span class="n">total_burst_spikes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">spikes_per_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_burst_spikes</span><span class="p">)</span>
                <span class="n">firingrate</span><span class="o">=</span><span class="n">total_burst_spikes</span><span class="o">/</span><span class="n">burst_lens</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">IBFRs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">firingrate</span><span class="p">)</span>
            <span class="n">intraBFR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">IBFRs</span><span class="p">))</span>
            <span class="n">mean_spikes_per_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes_per_burst</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intraBFR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
            <span class="n">mean_spikes_per_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>

        <span class="c1"># Calculate the mean absolute deviation of the amount of spikes per burst</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">MAD_spikes_per_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">spikes_per_burst</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes_per_burst</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MAD_spikes_per_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>

        <span class="c1"># Calculte the % of spikes that are isolated (not in a burst)</span>
        <span class="k">if</span> <span class="n">burst_spikes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">spike</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">isolated_spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">burst_spikes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">spike</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">isolated_spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>

        <span class="c1"># Calculate the single channel burst rate (bursts/s)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">SCB_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;measurements&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;sampling rate&#39;</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">SCB_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        
    <span class="c1"># Create pandas dataframe with all features as columns </span>
    <span class="n">features_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Well&quot;</span><span class="p">:</span> <span class="n">wells_df</span><span class="p">,</span>
        <span class="s2">&quot;Electrode&quot;</span><span class="p">:</span> <span class="n">electrodes_df</span><span class="p">,</span> 
        <span class="s2">&quot;Spikes&quot;</span><span class="p">:</span> <span class="n">spikes</span><span class="p">,</span>
        <span class="s2">&quot;Mean_FiringRate&quot;</span><span class="p">:</span> <span class="n">mean_firingrate</span><span class="p">,</span>
        <span class="s2">&quot;Mean_ISI&quot;</span><span class="p">:</span> <span class="n">mean_ISI</span><span class="p">,</span>
        <span class="s2">&quot;Median_ISI&quot;</span><span class="p">:</span> <span class="n">median_ISI</span><span class="p">,</span>
        <span class="s2">&quot;Ratio_median_ISI_over_mean_ISI&quot;</span><span class="p">:</span> <span class="n">ratio_median_over_mean</span><span class="p">,</span>
        <span class="s2">&quot;Interspike_interval_variance&quot;</span><span class="p">:</span> <span class="n">IIV</span><span class="p">,</span>
        <span class="s2">&quot;Coefficient_of_variation_ISI&quot;</span><span class="p">:</span> <span class="n">CVI</span><span class="p">,</span>
        <span class="s2">&quot;Partial_Autocorrelaction_Function&quot;</span><span class="p">:</span> <span class="n">ISIPACF</span><span class="p">,</span>
        <span class="s2">&quot;Total_number_of_bursts&quot;</span><span class="p">:</span> <span class="n">burst_amnt</span><span class="p">,</span>
        <span class="s2">&quot;Average_length_of_bursts&quot;</span><span class="p">:</span> <span class="n">avg_burst_len</span><span class="p">,</span>
        <span class="s2">&quot;Burst_length_variance&quot;</span><span class="p">:</span> <span class="n">burst_var</span><span class="p">,</span>
        <span class="s2">&quot;Coefficient_of_variation_burst_length&quot;</span><span class="p">:</span> <span class="n">burst_CV</span><span class="p">,</span>
        <span class="s2">&quot;Mean_interburst_interval&quot;</span><span class="p">:</span> <span class="n">mean_IBI</span><span class="p">,</span>
        <span class="s2">&quot;Variance_interburst_interval&quot;</span><span class="p">:</span> <span class="n">IBI_var</span><span class="p">,</span>
        <span class="s2">&quot;Coefficient_of_variation_IBI&quot;</span><span class="p">:</span> <span class="n">IBI_CV</span><span class="p">,</span>
        <span class="s2">&quot;Inter-burst_interval_PACF&quot;</span><span class="p">:</span> <span class="n">IBIPACF</span><span class="p">,</span>
        <span class="s2">&quot;Mean_intra_burst_firing_rate&quot;</span><span class="p">:</span> <span class="n">intraBFR</span><span class="p">,</span>
        <span class="s2">&quot;Mean_spikes_per_burst&quot;</span><span class="p">:</span> <span class="n">mean_spikes_per_burst</span><span class="p">,</span>
        <span class="s2">&quot;MAD_spikes_per_burst&quot;</span><span class="p">:</span> <span class="n">MAD_spikes_per_burst</span><span class="p">,</span>
        <span class="s2">&quot;Isolated_spikes&quot;</span><span class="p">:</span> <span class="n">isolated_spikes</span><span class="p">,</span>
        <span class="s2">&quot;Single_channel_burst_rate&quot;</span><span class="p">:</span> <span class="n">SCB_rate</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;remove inactive electrodes&#39;</span><span class="p">]:</span>
        <span class="c1"># Remove electrodes that do not have enough activity</span>
        <span class="n">features_df</span><span class="o">=</span><span class="n">features_df</span><span class="p">[</span><span class="n">features_df</span><span class="p">[</span><span class="s2">&quot;Mean_FiringRate&quot;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;activity threshold&#39;</span><span class="p">]]</span>
    <span class="c1"># Calculate how many electrodes were active</span>
    <span class="n">active_electrodes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">features_df</span><span class="p">)</span><span class="o">/</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">]</span>
    <span class="c1"># If none of the electrodes have enough activity, make sure we retain the well value</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_df</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">features_df</span><span class="p">[</span><span class="s2">&quot;Well&quot;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">well_nr</span><span class="p">]</span>
    <span class="n">features_df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Active_electrodes&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">active_electrodes</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">features_df</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">features_df</span></div>


<span class="sd">&#39;&#39;&#39;Calculate the features per well&#39;&#39;&#39;</span>
<div class="viewcode-block" id="well_features">
<a class="viewcode-back" href="../../CureQ.html#CureQ._features.well_features">[docs]</a>
<span class="k">def</span> <span class="nf">well_features</span><span class="p">(</span><span class="n">well</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate well features for a specific well</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    well : int</span>
<span class="sd">        The well for which the features are to be calculated.</span>
<span class="sd">    parameters : dict</span>
<span class="sd">        Dictionary containing global paramaters. The function will extract the values needed</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    well_features_df : pandas Dataframe</span>
<span class="sd">        Dataframe containing well features</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">spikepath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/spike_values&quot;</span>
    <span class="n">burstpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/burst_values&quot;</span>
    <span class="n">networkpath</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;output path&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">/network_data&quot;</span>

    <span class="c1"># Load in the network burst data</span>
    <span class="n">network_cores</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">networkpath</span><span class="si">}</span><span class="s2">/well_</span><span class="si">{</span><span class="n">well</span><span class="si">}</span><span class="s2">_network_bursts.npy&quot;</span><span class="p">)</span>
    <span class="n">participating_bursts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">networkpath</span><span class="si">}</span><span class="s2">/well_</span><span class="si">{</span><span class="n">well</span><span class="si">}</span><span class="s2">_participating_bursts.npy&quot;</span><span class="p">)</span>

    <span class="c1"># Load in data from electrodes from this well</span>
    <span class="n">spikedata_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">burstcores_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">burstspikes_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">electrodes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">parameters</span><span class="p">[</span><span class="s1">&#39;electrode amount&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">electrode</span> <span class="ow">in</span> <span class="n">electrodes</span><span class="p">:</span>
        <span class="n">spikedata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">spikepath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode</span><span class="si">}</span><span class="s1">_spikes.npy&#39;</span><span class="p">)</span>
        <span class="n">spikedata_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikedata</span><span class="p">)</span>
        <span class="n">burst_cores</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">burstpath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode</span><span class="si">}</span><span class="s1">_burst_cores.npy&#39;</span><span class="p">)</span>
        <span class="n">burstcores_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burst_cores</span><span class="p">)</span>
        <span class="n">burst_spikes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">burstpath</span><span class="si">}</span><span class="s1">/well_</span><span class="si">{</span><span class="n">well</span><span class="si">}</span><span class="s1">_electrode_</span><span class="si">{</span><span class="n">electrode</span><span class="si">}</span><span class="s1">_burst_spikes.npy&#39;</span><span class="p">)</span>
        <span class="n">burstspikes_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burst_spikes</span><span class="p">)</span>
    
    <span class="n">network_bursts</span><span class="p">,</span> <span class="n">network_burst_duration</span><span class="p">,</span> <span class="n">network_burst_core_duration</span><span class="p">,</span> <span class="n">network_IBI</span><span class="p">,</span> <span class="n">NB_NBc_ratio</span><span class="p">,</span> <span class="n">NB_firingrate</span><span class="p">,</span> <span class="n">NB_ISI</span><span class="p">,</span> <span class="n">mean_spikes_per_network_burst</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">nIBI_var</span><span class="p">,</span> <span class="n">nIBI_CV</span><span class="p">,</span> <span class="n">NB_NBC_ratio_left</span><span class="p">,</span> <span class="n">NB_NBC_ratio_right</span><span class="p">,</span> <span class="n">lr_NB_ratio</span><span class="p">,</span> <span class="n">NBC_duration_CV</span><span class="p">,</span> <span class="n">NIBIPACF</span><span class="p">,</span> <span class="n">participating_electrodes</span><span class="p">,</span> <span class="n">portion_spikes_in_nbs</span><span class="p">,</span> <span class="n">portion_bursts_in_nbs</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">        Calculate your own features here</span>
<span class="sd">        Step by step guide:</span>
<span class="sd">        1. Initialize a list prior to this for-loop, you will be adding the calculated feature of the well to this list</span>
<span class="sd">        2. You have access to the following variables after this line of code:</span>
<span class="sd">            network_cores = All the network bursts that have been detected in this well. Contains a row for each network burst, each row contains 5 columns</span>
<span class="sd">                network_bursts[burst, 0] = start of the network burst core (seconds)</span>
<span class="sd">                network_bursts[burst, 1] = end of the network burst core</span>
<span class="sd">                network_bursts[burst, 2] = start of the total network burst</span>
<span class="sd">                network_bursts[burst, 3] = end of the total network burst</span>
<span class="sd">                network_bursts[burst, 4] = ID of the network burst, used to couple network burst to participating single-channel bursts</span>
<span class="sd">            participating_bursts = All the bursts that have participated in a network burst in this well. Contains a row for each single-channel burst (SCB), each row contains 3 colomns</span>
<span class="sd">                participating_bursts[burst, 0] = The network burst ID</span>
<span class="sd">                participating_bursts[burst, 1] = The electrode on which the SCB happened</span>
<span class="sd">                participating_bursts[burst, 2] = The burst ID of the SCB</span>
<span class="sd">            spikedata_list</span>
<span class="sd">                spikedata from all the electrodes in this particular well. Index 0 is top left electrode, last index is bottom right electrode</span>
<span class="sd">                follows the same format as described in the electrode features</span>
<span class="sd">            burstcores_list</span>
<span class="sd">                same as previous, but for burst cores</span>
<span class="sd">            burstspikes_list</span>
<span class="sd">                same as previous, but for burst spikes</span>
<span class="sd">        3. Calculate the feature.</span>
<span class="sd">           Warning: sometimes it is not possible to calculate a features due to a lack of detected network bursts.</span>
<span class="sd">           always check if there are enough values to calculate the feature using an if-statement, if there are not, append &quot;float(&quot;NaN&quot;)&quot; to the list</span>
<span class="sd">        4. Append your feature to the list</span>
<span class="sd">        5. At the end of this function, add your list to the pandas dataframe, and give it the correct name.</span>
<span class="sd">           Now if you run the analysis again, you should see your own feature in the &quot;Features.csv&quot; output file</span>
<span class="sd">        If there are any questions, feel free to reach out!</span>
<span class="sd">-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="c1"># Calculate the total amount of network bursts</span>
    <span class="n">network_bursts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">))</span>

    <span class="c1"># Fill the features with NaN values if there are no network bursts</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">network_burst_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">network_burst_core_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NBC_duration_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NB_NBc_ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NB_NBC_ratio_left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NB_NBC_ratio_right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">lr_NB_ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">network_IBI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">nIBI_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">nIBI_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NIBIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">mean_spikes_per_network_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NB_firingrate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">NB_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">portion_spikes_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">portion_bursts_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="n">participating_electrodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Calculate the average length of a network burst</span>
        <span class="n">NB_duration</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)):</span>
            <span class="n">NB_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">network_burst_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">NB_duration</span><span class="p">))</span>

        <span class="c1"># Calculate the average length of a network burst core</span>
        <span class="n">NBC_duration</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)):</span>
            <span class="n">NBC_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">network_burst_core_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">NBC_duration</span><span class="p">))</span>
        
        <span class="c1"># Calculate the coefficient of variation of the network burst cores duration</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">NBC_duration</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">NBC_duration_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NBC_duration_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">NBC_duration</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">NBC_duration</span><span class="p">))</span>
        
        <span class="n">network_IBIs</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">network_IBI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate the network interburst interval</span>
            <span class="c1"># Iterate over the network bursts</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Calculate the distance to the next NB</span>
                <span class="n">dist</span><span class="o">=</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">network_IBIs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span>

            <span class="c1"># Calculate the mean</span>
            <span class="n">network_IBI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">nIBI_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
            <span class="n">nIBI_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Calculate the variance of the network IBI</span>
            <span class="n">nIBI_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">))</span>
            <span class="c1"># Calculate the coefficient of variation of the network IBI</span>
            <span class="n">nIBI_CV</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">))</span>

        <span class="c1"># Calculate the partial autocorrelation function of the network interburst intervals</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>     <span class="c1"># At least 4 values are needed for this calculation</span>
            <span class="n">NIBIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NIBIPACF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pacf</span><span class="p">(</span><span class="n">network_IBIs</span><span class="p">,</span> <span class="n">nlags</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;yw&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Calculate the intra-network burst firing rate and network burst inter spike interval</span>
        <span class="n">single_nb_firingrate</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">single_nb_ISI</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">spikes_per_network_burst</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">total_spikes_in_nbs</span><span class="o">=</span><span class="mi">0</span>

        <span class="k">for</span> <span class="n">network_burst</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)):</span>
            <span class="n">nb_spikes</span><span class="o">=</span><span class="p">[]</span>
            <span class="c1"># Identify all spikes that happened during the network burst</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikedata_list</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">spike</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikedata_list</span><span class="p">[</span><span class="n">channel</span><span class="p">])):</span>
                    <span class="c1"># Check whether this spike occured during the network burst</span>
                    <span class="k">if</span> <span class="n">network_cores</span><span class="p">[</span><span class="n">network_burst</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">spikedata_list</span><span class="p">[</span><span class="n">channel</span><span class="p">][</span><span class="n">spike</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">network_cores</span><span class="p">[</span><span class="n">network_burst</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
                        <span class="n">nb_spikes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spikedata_list</span><span class="p">[</span><span class="n">channel</span><span class="p">][</span><span class="n">spike</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># Calculate the NB firing rate</span>
            <span class="n">single_nb_firingrate</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">nb_spikes</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">network_cores</span><span class="p">[</span><span class="n">network_burst</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">network_burst</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
            <span class="n">total_spikes_in_nbs</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">nb_spikes</span><span class="p">)</span>
            <span class="c1"># Calculate the network burst inter spike interval</span>
            <span class="c1"># First sort the spike so they are on chronological order again</span>
            <span class="n">nb_spikes</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">nb_spikes</span><span class="p">)</span>
            <span class="c1"># Calculate the intervals</span>
            <span class="n">nb_spikes_intervals</span><span class="o">=</span><span class="n">nb_spikes</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nb_spikes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># Take the average</span>
            <span class="n">single_nb_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">nb_spikes_intervals</span><span class="p">))</span>
            
            <span class="n">spikes_per_network_burst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nb_spikes</span><span class="p">))</span>
        <span class="n">NB_firingrate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">single_nb_firingrate</span><span class="p">))</span>
        <span class="n">NB_ISI</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">single_nb_ISI</span><span class="p">))</span>
        <span class="n">mean_spikes_per_network_burst</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">spikes_per_network_burst</span><span class="p">)</span>

        <span class="c1"># Calculate the portion of spikes that participate in network bursts</span>
        <span class="n">total_spikes</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">spikedata_list</span><span class="p">)):</span>
            <span class="n">total_spikes</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">spikedata_list</span><span class="p">[</span><span class="n">channel</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">total_spikes_in_nbs</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">total_spikes</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">portion_spikes_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">portion_spikes_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_spikes_in_nbs</span><span class="o">/</span><span class="n">total_spikes</span><span class="p">)</span>

        <span class="c1"># Calculate the portion of bursts that participate in network bursts</span>
        <span class="n">burst_participating_in_nbs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">participating_bursts</span><span class="p">)</span>
        <span class="n">total_bursts</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">burstcores_list</span><span class="p">)):</span>
            <span class="n">total_bursts</span><span class="o">+=</span><span class="nb">len</span><span class="p">(</span><span class="n">burstcores_list</span><span class="p">[</span><span class="n">channel</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">burst_participating_in_nbs</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">total_bursts</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">portion_bursts_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="s2">&quot;NaN&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">portion_bursts_in_nbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burst_participating_in_nbs</span><span class="o">/</span><span class="n">total_bursts</span><span class="p">)</span>
        
        <span class="c1"># Calculate average the network burst to network burst core ratio</span>
        <span class="n">ratios</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)):</span>
            <span class="n">ratio</span><span class="o">=</span><span class="p">(</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
        <span class="n">NB_NBc_ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratios</span><span class="p">))</span>

        <span class="c1"># Calculate the ratio of the length of the left/right outer part of the network burst compared to the core</span>
        <span class="n">left_ratios</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">right_ratios</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">lr_ratios</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">network_cores</span><span class="p">)):</span>
            <span class="n">burst_core_length</span><span class="o">=</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">left_outer_burst</span><span class="o">=</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">right_outer_burst</span><span class="o">=</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">network_cores</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># Sometimes the burst has no outer edges, so we get a division by 0, check for that here</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">left_outer_burst</span><span class="p">,</span> <span class="n">right_outer_burst</span><span class="p">])</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="c1"># In that case append 0</span>
                <span class="n">lr_ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lr_ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_outer_burst</span><span class="o">/</span><span class="n">right_outer_burst</span><span class="p">)</span>
            <span class="n">left_ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">left_outer_burst</span><span class="o">/</span><span class="n">burst_core_length</span><span class="p">)</span>
            <span class="n">right_ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">right_outer_burst</span><span class="o">/</span><span class="n">burst_core_length</span><span class="p">)</span>
        <span class="n">NB_NBC_ratio_left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">left_ratios</span><span class="p">))</span>
        <span class="n">NB_NBC_ratio_right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">right_ratios</span><span class="p">))</span>
        <span class="n">lr_NB_ratio</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lr_ratios</span><span class="p">))</span>

        <span class="c1"># Calculate the average amount of electrodes that contribute to a network burst</span>
        <span class="n">single_participating_channels</span><span class="o">=</span><span class="p">[]</span>
        <span class="c1"># Loop through the network bursts</span>
        <span class="k">for</span> <span class="n">network_burst</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">participating_bursts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># Calculate the amount of electrodes that participated</span>
            <span class="n">electrodes_participated</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">participating_bursts</span><span class="p">[</span><span class="n">participating_bursts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">network_burst</span><span class="p">][:,</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">single_participating_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">electrodes_participated</span><span class="p">)</span>
        <span class="n">participating_electrodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">single_participating_channels</span><span class="p">))</span>

    <span class="c1"># Create pandas dataframe with all features as columns </span>
    <span class="n">well_features_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s2">&quot;Well&quot;</span><span class="p">:[</span><span class="n">well</span><span class="p">],</span>
        <span class="s2">&quot;Network_bursts&quot;</span><span class="p">:</span> <span class="n">network_bursts</span><span class="p">,</span>
        <span class="s2">&quot;Network_burst_duration&quot;</span><span class="p">:</span> <span class="n">network_burst_duration</span><span class="p">,</span>
        <span class="s2">&quot;Network_burst_core_duration&quot;</span><span class="p">:</span> <span class="n">network_burst_core_duration</span><span class="p">,</span>
        <span class="s2">&quot;Network_burst_core_duration_CV&quot;</span><span class="p">:</span> <span class="n">NBC_duration_CV</span><span class="p">,</span>
        <span class="s2">&quot;Network_interburst_interval&quot;</span><span class="p">:</span> <span class="n">network_IBI</span><span class="p">,</span>
        <span class="s2">&quot;Network_IBI_PACF&quot;</span><span class="p">:</span> <span class="n">NIBIPACF</span><span class="p">,</span>
        <span class="s2">&quot;NB_to_NBc_ratio&quot;</span><span class="p">:</span> <span class="n">NB_NBc_ratio</span><span class="p">,</span>
        <span class="s2">&quot;Network_IBI_variance&quot;</span><span class="p">:</span> <span class="n">nIBI_var</span><span class="p">,</span>
        <span class="s2">&quot;Network_IBI_coefficient_of_variation&quot;</span><span class="p">:</span> <span class="n">nIBI_CV</span><span class="p">,</span>
        <span class="s2">&quot;Mean_spikes_per_network_burst&quot;</span><span class="p">:</span> <span class="n">mean_spikes_per_network_burst</span><span class="p">,</span>
        <span class="s2">&quot;Network_burst_firing_rate&quot;</span><span class="p">:</span> <span class="n">NB_firingrate</span><span class="p">,</span>
        <span class="s2">&quot;Network_burst_ISI&quot;</span><span class="p">:</span> <span class="n">NB_ISI</span><span class="p">,</span>
        <span class="s2">&quot;Portion_spikes_in_network_bursts&quot;</span><span class="p">:</span> <span class="n">portion_spikes_in_nbs</span><span class="p">,</span>
        <span class="s2">&quot;Portion_bursts_in_network_bursts&quot;</span><span class="p">:</span> <span class="n">portion_bursts_in_nbs</span><span class="p">,</span>
        <span class="s2">&quot;Ratio_left_outer_burst_over_core&quot;</span><span class="p">:</span> <span class="n">NB_NBC_ratio_left</span><span class="p">,</span>
        <span class="s2">&quot;Ratio_right_outer_burst_over_core&quot;</span><span class="p">:</span> <span class="n">NB_NBC_ratio_right</span><span class="p">,</span>
        <span class="s2">&quot;Ratio_left_outer_right_outer&quot;</span><span class="p">:</span> <span class="n">lr_NB_ratio</span><span class="p">,</span>
        <span class="s2">&quot;Participating_electrodes&quot;</span><span class="p">:</span> <span class="n">participating_electrodes</span>
    <span class="p">})</span>
    <span class="k">return</span> <span class="n">well_features_df</span></div>

 

<div class="viewcode-block" id="feature_output">
<a class="viewcode-back" href="../../CureQ.html#CureQ._features.feature_output">[docs]</a>
<span class="k">def</span> <span class="nf">feature_output</span><span class="p">(</span><span class="n">electrode_features</span><span class="p">,</span> <span class="n">well_features</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to combine and clean up electrode and well features dataframes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    electrode_features : pandas Dataframe</span>
<span class="sd">        Electrodes features.</span>
<span class="sd">    well_features : pandas Dataframe</span>
<span class="sd">        Well features.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    avg_electrode_features : pandas Dataframe</span>
<span class="sd">        Combined single electrode and well features</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function will do the following things:</span>
<span class="sd">    </span>
<span class="sd">    - Take the average of all single electrode features of a well.</span>
<span class="sd">    - Remove unnecessary and duplicate columns.</span>
<span class="sd">    - Combine the average electrode and well features.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Take the average of all the single-electrode features</span>
    <span class="n">avg_electrode_features</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">electrode_features</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="c1"># Remove unnecessary columns</span>
    <span class="n">avg_electrode_features</span><span class="o">=</span><span class="n">avg_electrode_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Electrode&quot;</span><span class="p">])</span>
    <span class="n">well_features</span><span class="o">=</span><span class="n">well_features</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Well&quot;</span><span class="p">])</span>

    <span class="c1"># Combine the dataframes</span>
    <span class="n">avg_electrode_features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">avg_electrode_features</span><span class="p">,</span> <span class="n">well_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">avg_electrode_features</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, K.J. van Beem.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>